version: '2'

services:
    db:
        build: ./database
        container_name: data1
        environment:
            - MYSQL_DATABASE=${MYSQL_DATABASE}
            - MYSQL_USER=${MYSQL_USER}
            - MYSQL_PASSWORD=${MYSQL_PASSWORD}
            - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
        dns: 192.168.30.2
        networks:
            entreprise:
                ipv4_address: 192.168.10.2

    web:
        build: ./web
        container_name: web1
        dns: 192.168.30.2
        networks:
            entreprise:
                ipv4_address: 192.168.30.3
        volumes:
            - ../certificate/apache.crt:/etc/apache2/certificate/apache.crt
            - ../certificate/apache.key:/etc/apache2/certificate/apache.key

    caddy:
        build: ./web/caddy
        container_name: caddy
        ports:
            - 80:80
            - 443:443
        dns: 192.168.30.2
        networks:
            entreprise:
                ipv4_address: 192.168.30.6
        volumes:
            - /var/log/access.log:/var/log/access.log

    dns:
        build: ./DNS
        container_name: dns
        volumes: 
            - ../keys:/keys
        ports:
            - '53:53/udp'
            - '53:53/tcp'
        dns: 192.168.30.2
        networks:
            entreprise:
                ipv4_address: 192.168.30.2

    directeur:
        build: ./employes/default
        container_name: directeur
        stdin_open: true
        dns: 192.168.30.2
        networks:
            entreprise:
                ipv4_address: 192.168.0.2
        volumes: 
            - /home/cyril/certificate/ca.crt:/usr/local/share/ca-certificates/ca.crt

    commerciaux1:
        build: ./employes/default
        container_name: commerciaux1
        stdin_open: true
        dns: 192.168.30.2
        networks:
            entreprise:
                ipv4_address: 192.168.0.34
        volumes: 
            - /home/cyril/certificate/ca.crt:/usr/local/share/ca-certificates/ca.crt

    commerciaux2:
        build: ./employes/default
        container_name: commerciaux2
        stdin_open: true
        dns: 192.168.30.2
        networks:
            entreprise:
                ipv4_address: 192.168.0.35
        volumes: 
            - /home/cyril/certificate/ca.crt:/usr/local/share/ca-certificates/ca.crt

    secretaire:
        build: ./employes/default
        container_name: secretaire
        stdin_open: true
        dns: 192.168.30.2
        networks:
            entreprise:
                ipv4_address: 192.168.0.66
        volumes: 
            - /home/cyril/certificate/ca.crt:/usr/local/share/ca-certificates/ca.crt

    hangar:
        build: ./employes/default
        container_name: hangar
        stdin_open: true
        dns: 192.168.30.2
        networks:
            entreprise:
                ipv4_address: 192.168.0.99
        volumes: 
            - /home/cyril/certificate/ca.crt:/usr/local/share/ca-certificates/ca.crt

    atelier:
        build: ./employes/default
        container_name: atelier
        stdin_open: true
        dns: 192.168.30.2
        networks:
            entreprise:
                ipv4_address: 192.168.0.98
        volumes: 
            - /home/cyril/certificate/ca.crt:/usr/local/share/ca-certificates/ca.crt

    comptable1:
        build: ./employes/default
        container_name: comptable1
        stdin_open: true
        dns: 192.168.30.2
        networks:
            entreprise:
                ipv4_address: 192.168.0.130
        volumes: 
            - /home/cyril/certificate/ca.crt:/usr/local/share/ca-certificates/ca.crt

    comptable2:
        build: ./employes/default
        container_name: comptable2
        stdin_open: true
        dns: 192.168.30.2
        networks:
            entreprise:
                ipv4_address: 192.168.0.131
        volumes: 
            - /home/cyril/certificate/ca.crt:/usr/local/share/ca-certificates/ca.crt
    
    mail:
        build:
            context: ./Mails
            dockerfile: Dockerfile
        dns: 192.168.30.2
        ports:
            - "25:25"
            - "143:143"
            - "465:465"
            - "587:587"
            - "993:993"
        networks:
            entreprise:
                ipv4_address: 192.168.30.5
        environment:
            MYSQL_ROOT_PASSWORD: root
        hostname: mail
        container_name: mail


networks:
    entreprise:
        ipam:
            driver: default
            config:
                - subnet: 192.168.0.0/16





